#/*
# * Copyright 2008-2019 Anael Mobilia
# *
# * This file is part of image-heberg.fr.
# *
# * image-heberg.fr is free software: you can redistribute it and/or modify
# * it under the terms of the GNU General Public License as published by
# * the Free Software Foundation, either version 3 of the License, or
# * (at your option) any later version.
# *
# * image-heberg.fr is distributed in the hope that it will be useful,
# * but WITHOUT ANY WARRANTY; without even the implied warranty of
# * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# * GNU General Public License for more details.
# *
# * You should have received a copy of the GNU General Public License
# * along with image-heberg.fr. If not, see <http://www.gnu.org/licenses/>
# */
# Language
language: php
# Versions de PHP testées
matrix:
  include:
    - php: 5.6
    - php: 7.0
    - php: 7.1
    - php: 7.2
    - php: 7.3
    - php: 7.4
    - php: nightly
  allow_failures:
    - php: 7.4
    - php: nightly

# Autres prérequis
services:
  - mysql

# Créer la BDD avant de commencer
before_script:
  # Version de mysql
  - mysql -V
  # Création de la BDD
  - mysql -e "CREATE DATABASE imageheberg;"
  # Injection des tables de base
  - mysql imageheberg < database.sql
  # Copie du fichier de configuration
  - sh -c "mv __tests/config/config.php config/"
  # Insertion d'un jeu de données de test
  - mysql imageheberg < __tests/data.sql

jobs:
    include:
        - php: 5.6
          script:
              - phpunit --version
              - phpunit --colors --debug __tests/

        - php: 7.0
          script:
              - wget https://phar.phpunit.de/phpunit-6.phar
              - chmod +x phpunit-6.phar
              - ./phpunit-6.phar --version
              - ./phpunit-6.phar --colors --debug __tests/

        - php: 7.1
          script:
              - wget https://phar.phpunit.de/phpunit-7.phar
              - chmod +x phpunit-7.phar
              - ./phpunit-7.phar --version
              - ./phpunit-7.phar --colors --debug __tests/

        - php: 7.2
          script:
              - phpunit --version
              - phpunit --colors --debug __tests/

        - php: 7.3
          script:
              - phpunit --version
              - phpunit --colors --debug __tests/

        - php: 7.4
          script:
              - phpunit --version
              - phpunit --colors --debug __tests/

        - php: nightly
          script:
              - phpunit --version
              - phpunit --colors --debug __tests/